<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>KΔIRA | Model</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,300;400;600&display=swap" rel="stylesheet">
  <link rel="icon" href="/favicon.ico" />
  <meta name="theme-color" content="#111827" />
  <link rel="manifest" href="/site.webmanifest" />
  <link rel="stylesheet" href="/css/main.css" />
  <style>
    body{ background: radial-gradient(1200px 800px at 70% -10%, rgba(34,197,94,.12), transparent 60%), radial-gradient(1200px 800px at 0% 110%, rgba(59,130,246,.12), transparent 60%), #000; }
    .hero-grad { background: radial-gradient(800px 400px at 50% 0%, rgba(99,102,241,.25), rgba(99,102,241,0) 60%); }
    .shell { backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); background: rgba(17,24,39,0.65); border: 1px solid rgba(255,255,255,0.08); }
    .pill { border: 1px solid rgba(255,255,255,0.12); background: rgba(30,41,59,0.7); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body class="antialiased text-slate-200">
  <!-- Top navigation -->
  <header class="fixed top-0 inset-x-0 z-50">
    <div class="max-w-7xl mx-auto px-4">
      <div class="h-16 flex items-center justify-between shell rounded-b-2xl px-4">
        <a href="/index.html?skipIntro=1" class="flex items-center gap-2 text-white font-semibold">
          <span class="text-cyan-300">KΔIRA</span><span class="text-slate-300">Model</span>
        </a>
        <nav class="flex items-center gap-2">
          <a href="/index.html?skipIntro=1#modules" class="pill px-3 py-1.5 rounded-full text-sm text-gray-300 hover:text-white">Modüller</a>
          <a href="/index.html?skipIntro=1&start=chat" class="pill px-3 py-1.5 rounded-full text-sm text-gray-300 hover:text-white">Deneyin</a>
          <a href="/contact.html" class="pill px-3 py-1.5 rounded-full text-sm text-gray-300 hover:text-white">İletişim</a>
          <a href="/profile.html" class="pill px-3 py-1.5 rounded-full text-sm text-gray-300 hover:text-white">Üyelik</a>
        </nav>
      </div>
    </div>
  </header>

  <main class="pt-24 pb-16">
    <!-- Hero -->
    <section class="hero-grad">
      <div class="max-w-7xl mx-auto px-4">
        <div class="grid md:grid-cols-2 gap-8 items-center">
          <div>
            <h1 class="text-4xl md:text-6xl font-serif font-light text-white mb-4">KΔIRA Ailesi</h1>
            <p class="text-lg text-slate-300">Hız, kalite ve güvenlik arasında en iyi dengeyi sunan çok‑modlu (metin, ses, görsel) akıllı model ailesi. Türkiye odaklı veri anlayışı ve Türkçe için doğal akış.</p>
            <div class="mt-6 flex gap-3">
              <a href="/index.html?skipIntro=1&start=chat" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-5 py-2.5 rounded-lg">Hemen Dene</a>
              <a href="#models" class="pill px-4 py-2 rounded-lg text-gray-300 hover:text-white">Modelleri Gör</a>
            </div>
            <div class="mt-6 flex items-center gap-3 text-sm text-slate-400">
              <span class="inline-flex items-center gap-1 pill px-2 py-1 rounded-full">🔒 Guard: Güvenlik & Filtre</span>
              <span class="inline-flex items-center gap-1 pill px-2 py-1 rounded-full">⚡ Canlı Demo</span>
              <span class="inline-flex items-center gap-1 pill px-2 py-1 rounded-full">🗣️ TR Doğal</span>
            </div>
          </div>
          <div class="relative">
            <div class="shell rounded-2xl p-6">
              <div class="text-sm text-slate-300 mb-2">Örnek konuşma</div>
              <div class="bg-gray-800/60 border border-gray-700 rounded-xl p-4 space-y-2">
                <div class="chat-user-bubble max-w-[90%] px-4 py-2 rounded-lg">İstanbul’da 1 günde görülecek 5 yer öner.</div>
                <div class="chat-assistant-bubble max-w-[90%] px-4 py-2 rounded-lg">Tabii! Hızlı bir rota: 1) Ayasofya 2) Topkapı 3) Kapalıçarşı 4) Galata 5) Ortaköy. Zaman kalırsa Balat’ta kahve molası öneririm.</div>
              </div>
              <div class="mt-4 flex gap-3">
                <a href="/index.html?skipIntro=1&start=chat" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg">Sohbete Git</a>
                <a href="#api" class="pill px-4 py-2 rounded-lg">API Hızlı Başlangıç</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Models -->
    <section id="models" class="mt-16">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-semibold text-white mb-6">Model Ailesi</h2>
        <div class="grid md:grid-cols-3 gap-6">
          <div class="shell rounded-2xl p-6">
            <div class="text-sm text-cyan-300 mb-1">Genel Asistan</div>
            <div class="text-xl font-semibold text-white">KΔIRA‑Core</div>
            <p class="text-slate-400 mt-2">Günlük yardımcı, analiz ve içerik üretiminde dengeli. TR bağlamında güçlü.</p>
            <ul class="text-sm text-slate-400 mt-3 list-disc pl-5 space-y-1">
              <li>Uzun bağlam, planlama</li>
              <li>Hızlı ve ekonomik</li>
              <li>Güvenli cevap filtresi</li>
            </ul>
          </div>
          <div class="shell rounded-2xl p-6">
            <div class="text-sm text-rose-300 mb-1">Sesli Asistan</div>
            <div class="text-xl font-semibold text-white">KΔIRA‑Voice</div>
            <p class="text-slate-400 mt-2">Doğal Türkçe diyalog, TTS ve VAD ile akıcı real‑time konuşma.</p>
            <ul class="text-sm text-slate-400 mt-3 list-disc pl-5 space-y-1">
              <li>Düşük gecikme TTS</li>
              <li>Web/Safari uyumlu</li>
              <li>Gürültüye dayanım</li>
            </ul>
          </div>
          <div class="shell rounded-2xl p-6">
            <div class="text-sm text-amber-300 mb-1">Görüntü & Düzenleme</div>
            <div class="text-xl font-semibold text-white">KΔIRA‑Vision</div>
            <p class="text-slate-400 mt-2">Fotoğraf anlama + düzenleme yönlendirmeleri; kimlik koruma & maskeleme.</p>
            <ul class="text-sm text-slate-400 mt-3 list-disc pl-5 space-y-1">
              <li>Yerel maske/iyileştirme</li>
              <li>Kimlik koruma</li>
              <li>GPU opsiyonlu</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Knowledge Base (RAG) -->
    <section id="kb" class="mt-16">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-semibold text-white mb-6">Knowledge Base (RAG) !Yapım Aşamasında!</h2>
        <div class="grid md:grid-cols-3 gap-6">
          <!-- Chat with Knowledge -->
          <div class="md:col-span-2 shell rounded-2xl p-6">
            <div class="mb-3 grid md:grid-cols-3 gap-3">
              <div>
                <label class="block text-sm text-slate-300 mb-1">Workspace</label>
                <select id="kb-ws" class="allow-select w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white"></select>
              </div>
              <div>
                <label class="block text-sm text-slate-300 mb-1">Top‑K</label>
                <input id="kb-topk" type="number" min="1" max="10" value="5" class="allow-select w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white" />
              </div>
              <div>
                <label class="block text-sm text-slate-300 mb-1">Temperature</label>
                <input id="kb-temp" type="number" step="0.05" min="0" max="1" value="0.35" class="allow-select w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white" />
              </div>
            </div>
            <div id="kb-chat" class="h-[320px] overflow-y-auto bg-black/30 border border-gray-800 rounded p-3 space-y-2"></div>
            <div class="mt-3 flex gap-2">
              <input id="kb-input" class="allow-select flex-1 bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white" placeholder="Bilginle konuş..." />
              <button id="kb-send" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded">Gönder</button>
            </div>
            <div id="kb-msg" class="text-sm mt-2 text-slate-400"></div>
          </div>
          <!-- KB Manage -->
          <div class="shell rounded-2xl p-6">
            <div class="text-sm text-slate-300 mb-2">Workspace Yönetimi</div>
            <div class="flex gap-2 mb-3">
              <input id="kb-ws-name" class="allow-select flex-1 bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white" placeholder="Yeni workspace adı" />
              <button id="kb-ws-create" class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold px-3 py-2 rounded">Oluştur</button>
            </div>
            <div class="text-sm text-slate-300 mb-2">İçerik Ekle</div>
            <div class="space-y-2">
              <textarea id="kb-add-text" rows="4" class="allow-select w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white" placeholder="Metni buraya yapıştır"></textarea>
              <button id="kb-add-text-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-3 py-2 rounded">Metin Ekle</button>
              <input id="kb-add-url" class="allow-select w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white" placeholder="https://..." />
              <button id="kb-add-url-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-3 py-2 rounded">URL Tara</button>
              <input id="kb-add-file" type="file" class="allow-select w-full bg-gray-800 border border-gray-700 rounded px-3 py-2 text-white" />
              <button id="kb-add-file-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-3 py-2 rounded">Dosya Ekle</button>
            </div>
            <div class="mt-4 text-sm">
              <div id="kb-stats" class="text-slate-400">İstatistik yükleniyor...</div>
              <div id="kb-last" class="text-slate-400 mt-2 space-y-1"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <!-- API Quickstart -->
    <section id="api" class="mt-16">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-semibold text-white mb-6">API Hızlı Başlangıç</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="shell rounded-2xl p-6">
            <div class="text-sm text-slate-400 mb-2">cURL — Düşünen</div>
            <pre class="mono text-sm bg-black/60 border border-gray-800 rounded-xl p-4 overflow-x-auto text-slate-300">curl -X POST "$BASE/api/think" \
 -H "Content-Type: application/json" \
 -d '{
   "prompt": "Merhaba, bugün hava nasıl?",
   "history": []
 }'</pre>
          </div>
          <div class="shell rounded-2xl p-6">
            <div class="text-sm text-slate-400 mb-2">cURL — Öğrenen</div>
            <pre class="mono text-sm bg-black/60 border border-gray-800 rounded-xl p-4 overflow-x-auto text-slate-300">curl -X POST "$BASE/api/answer" \
 -H "Content-Type: application/json" \
 -d '{
   "prompt": "KAIRA nedir?"
 }'</pre>
          </div>
        </div>
        <div class="mt-4 text-slate-400 text-sm">Not: `$BASE`, ayarladığınız sunucu kök URL’sidir (örn. ngrok veya kendi alan adınız).</div>
      </div>
    </section>

    <!-- SSS -->
    <section class="mt-16">
      <div class="max-w-7xl mx-auto px-4">
        <h2 class="text-2xl md:text-3xl font-semibold text-white mb-6">Sık Sorulanlar</h2>
        <div class="grid md:grid-cols-2 gap-6">
          <div class="shell rounded-2xl p-6">
            <div class="text-white font-semibold mb-1">Verilerim nasıl korunuyor?</div>
            <div class="text-slate-400">İstekler HTTPS ile iletilir; yerelde yalnızca temel oturum bilgileri tutulur. İsteğe bağlı sunucu günlükleri devre dışı bırakılabilir.</div>
          </div>
          <div class="shell rounded-2xl p-6">
            <div class="text-white font-semibold mb-1">Modelleri nasıl denerim?</div>
            <div class="text-slate-400">Üstte “Deneyin” ile Evrensel Sohbet’e geçebilir, sağlayıcı/model seçip konuşmaya başlayabilirsiniz.</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer class="mt-16">
    <div class="max-w-7xl mx-auto px-4 pb-10">
      <div class="shell rounded-2xl p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div class="text-slate-400 text-sm">© KΔIRA • Tüm hakları saklıdır.</div>
        <div class="flex items-center gap-3 text-sm">
          <a href="/contact.html" class="pill px-3 py-1.5 rounded-full text-gray-300 hover:text-white">İletişim</a>
          <a href="https://huggingface.co/umutkkgz" target="_blank" rel="noopener" class="pill px-3 py-1.5 rounded-full text-gray-300 hover:text-white">Hugging Face</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- Arka plan yıldız alanı (opsiyonel) -->
  <canvas id="starfield-canvas" aria-hidden="true"></canvas>
  <script src="/js/starfield.js"></script>
  <script src="/js/status-badge.js"></script>
  <script type="module" src="/js/auth.js"></script>
  <script>
    (function(){
      function base(){ try{ return (window.API_PROXY_BASE || localStorage.getItem('kaira_api_base') || '').replace(/\/$/,''); }catch(_){ return ''; } }
      function el(id){ return document.getElementById(id); }
      const wsSel = el('kb-ws'); const wsName = el('kb-ws-name');
      const wsCreate = el('kb-ws-create'); const statsEl = el('kb-stats'); const lastEl = el('kb-last');
      const addText = el('kb-add-text'); const addTextBtn = el('kb-add-text-btn');
      const addUrl = el('kb-add-url'); const addUrlBtn = el('kb-add-url-btn');
      const addFile = el('kb-add-file'); const addFileBtn = el('kb-add-file-btn');
      const topkEl = el('kb-topk'); const tempEl = el('kb-temp');
      const chatBox = el('kb-chat'); const input = el('kb-input'); const send = el('kb-send'); const msg = el('kb-msg');

      function msgBox(text, role){
        const b = document.createElement('div');
        b.className = 'px-3 py-2 rounded '+(role==='user'?'bg-indigo-700/40 text-indigo-100':'bg-gray-800 text-slate-200');
        b.textContent = (role==='user'?'👤 ':'🤖 ') + text;
        chatBox.appendChild(b); chatBox.scrollTop = chatBox.scrollHeight;
      }
      async function loadWs(){
        try{ wsSel.innerHTML=''; const r = await fetch(base()+'/api/rag/workspace/list'); const j = await r.json();
          (j.workspaces||['default']).forEach(n=>{ const o=document.createElement('option'); o.value=n; o.textContent=n; wsSel.appendChild(o); });
          if (!j.workspaces || !j.workspaces.length){ wsSel.value='default'; }
          refreshStats();
        }catch(_){ }
      }
      async function refreshStats(){
        try{ const r = await fetch(`${base()}/api/rag/stats?workspace=${encodeURIComponent(wsSel.value||'default')}`); const j = await r.json();
          statsEl.textContent = `Vectors: ${j.vectors||0} • Records: ${j.records||0} • FAISS: ${j.faiss?'Evet':'Hayır'}`;
          lastEl.innerHTML = (j.last||[]).map(x=>`<div class=\"text-xs\">• ${String((x.text||'')).slice(0,100)}...</div>`).join('');
        }catch(_){ statsEl.textContent='İstatistik alınamadı'; }
      }
      async function wsCreateFn(){ const n = (wsName.value||'').trim(); if (!n) return; try{ await fetch(base()+'/api/rag/workspace/create',{ method:'POST', body: new URLSearchParams({ name:n })}); wsName.value=''; await loadWs(); wsSel.value=n; refreshStats(); }catch(_){}}
      async function add(kind){
        const fd = new FormData(); fd.append('workspace', wsSel.value||'default'); fd.append('source_type', kind);
        if (kind==='text'){ const t=(addText.value||'').trim(); if (!t) return; fd.append('text',t); }
        if (kind==='url'){ const u=(addUrl.value||'').trim(); if (!u) return; fd.append('url',u); }
        if (kind==='file'){ const f=addFile.files&&addFile.files[0]; if (!f) return; fd.append('file',f); }
        msg.textContent='Ekleniyor...';
        try{ const r = await fetch(base()+'/api/rag/add', { method:'POST', body: fd }); const j = await r.json(); if (!r.ok){ throw new Error(j.error||'Hata'); }
          msg.textContent = `Eklendi: ${j.chunks} parça`;
          if (kind==='text') addText.value=''; if (kind==='url') addUrl.value=''; if (kind==='file') addFile.value='';
          refreshStats();
        }catch(e){ msg.textContent='Hata: '+(e&&e.message||e); }
      }
      async function sendChat(){
        const t=(input.value||'').trim(); if(!t) return; input.value=''; msgBox(t,'user'); msg.textContent='';
        const body = JSON.stringify({ prompt:t, workspace: wsSel.value||'default', top_k: Number(topkEl.value||5), temperature: Number(tempEl.value||0.35) });
        // Try streaming first
        try{
          const r = await fetch(base()+'/api/rag/chat/stream', { method:'POST', headers:{ 'Content-Type':'application/json' }, body });
          if (!r.ok || !r.body){ throw new Error('stream not ok'); }
          const reader = r.body.getReader();
          const dec = new TextDecoder();
          let acc = '';
          while(true){
            const {value, done} = await reader.read(); if (done) break;
            const chunk = dec.decode(value, {stream:true});
            const lines = chunk.split('\n');
            for (const line of lines){
              const s=line.trim(); if (!s) continue;
              try{
                const j = JSON.parse(s);
                if (j.response){ acc += j.response; }
                if (j.error){ msg.textContent = 'Hata: '+j.error; }
              }catch(_){ }
            }
            if (acc){
              // update last bot bubble or add if missing
              if (!chatBox.lastChild || chatBox.lastChild && chatBox.lastChild.textContent.startsWith('👤 ')){
                msgBox('', 'bot');
              }
              chatBox.lastChild.textContent = '🤖 ' + acc;
              chatBox.scrollTop = chatBox.scrollHeight;
            }
          }
          if (!acc){ throw new Error('empty'); }
          return;
        }catch(_){ /* fallback below */ }
        try{
          const r2 = await fetch(base()+'/api/rag/chat', { method:'POST', headers:{ 'Content-Type':'application/json' }, body });
          const j2 = await r2.json(); if (!r2.ok){ throw new Error(j2.error||'Hata'); }
          msgBox(j2.answer||'', 'bot');
        }catch(e){ msg.textContent='Hata: '+(e&&e.message||e); }
      }
      if (wsCreate) wsCreate.addEventListener('click', wsCreateFn);
      if (addTextBtn) addTextBtn.addEventListener('click', ()=>add('text'));
      if (addUrlBtn) addUrlBtn.addEventListener('click', ()=>add('url'));
      if (addFileBtn) addFileBtn.addEventListener('click', ()=>add('file'));
      if (send) send.addEventListener('click', sendChat);
      if (input) input.addEventListener('keydown', (e)=>{ if (e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendChat(); } });
      if (wsSel) wsSel.addEventListener('change', refreshStats);
      loadWs();
    })();
  </script>
</body>
</html>
