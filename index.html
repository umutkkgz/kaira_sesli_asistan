<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KΔIRA - Giriş Animasyonu</title>
    
    <!-- Gerekli Kütüphaneler: Three.js (3D için) ve GSAP (Animasyon için) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>
    
    <style>
        /* Sayfanın tamamını kaplaması ve kaydırma çubuklarını kaldırması için temel stiller */
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000000;
            font-family: 'Inter', sans-serif; /* Projenin fontuyla uyumlu */
            cursor: move; /* Etkileşimi belirtmek için imleci değiştir */
        }

        /* Animasyonun ana konteyneri. Her şey bunun içinde olacak. */
        #intro-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999; /* Diğer tüm içeriklerin üzerinde olmasını sağlar */
            background-color: #000000;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
        }

        /* 3D sahnenin render edileceği canvas */
        #bg-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        /* Logo ve buton gibi arayüz elemanlarının konteyneri */
        #ui-container {
            position: relative;
            z-index: 10;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Başlangıçta görünmez olacak, animasyonla ortaya çıkacak */
            opacity: 0;
        }

        /* KAIRA Logo Stili */
        #logo {
            font-size: 6vw; /* Ekran boyutuna göre ölçeklenir */
            font-weight: 700;
            letter-spacing: 0.5rem;
            text-transform: uppercase;
            margin-bottom: 1rem;
            color: #e2e8f0; /* Projenin rengiyle uyumlu */
        }
        
        /* Logodaki Delta (Δ) sembolünün özel rengi */
        #logo .delta {
            color: #22d3ee; /* Projenin cyan rengi */
            text-shadow: 0 0 20px #22d3ee;
        }

        /* YENİ: Alt Başlık Stili */
        #subtitle {
            font-size: 1.2vw;
            font-weight: 300;
            letter-spacing: 0.2rem;
            color: #94a3b8; /* slate-400 */
            margin-bottom: 3rem;
            text-transform: uppercase;
            opacity: 0; /* Animasyonla görünecek */
        }

        /* Giriş Butonu Stili */
        #enter-button {
            background: rgba(34, 211, 238, 0.1); /* Cyan renginin şeffaf hali */
            border: 1px solid rgba(34, 211, 238, 0.4);
            color: #e2e8f0;
            padding: 1rem 2.5rem;
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: 0.1rem;
            border-radius: 50px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.3s ease;
            text-transform: uppercase;
            /* Başlangıçta görünmez ve küçük olacak */
            opacity: 0;
            transform: scale(0.8);
        }

        #enter-button:hover {
            background: rgba(34, 211, 238, 0.2);
            transform: scale(1.05);
        }
    </style>
</head>
<body>

    <!-- Bu bölüm, sitenin ana giriş animasyonunu içerir. -->
    <!-- Kullanıcı butona tıkladığında bu konteyner kaybolur ve alttaki site içeriği görünür. -->
    <div id="intro-container">
        <canvas id="bg-canvas"></canvas>
        <div id="ui-container">
            <h1 id="logo">K<span class="delta">Δ</span>IRA</h1>
            <p id="subtitle">Dijital Bilinç Başlatılıyor</p>
            <button id="enter-button">DENEYİMİ BAŞLAT</button>
        </div>
    </div>

<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KΔIRA | Birleşik Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Serif+4:opsz,wght@8..60,300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- React için Gerekli Scriptler -->
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #000000;
            color: #e2e8f0;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .view { display: none; }
        .view.active { display: block; }

        /* Digital Afterlife Stilleri */
        #afterlife-bg-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.6; }
        .afterlife-section { min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 5rem 1.5rem; position: relative; z-index: 1; }
        .font-serif { font-family: 'Source Serif 4', serif; }
        .fade-in-up { opacity: 0; transform: translateY(20px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .is-visible .fade-in-up { opacity: 1; transform: translateY(0); }
        .delay-1 { transition-delay: 0.2s; }
        .delay-2 { transition-delay: 0.4s; }
        .delay-3 { transition-delay: 0.6s; }
        .feature-card { border: 1px solid rgba(255, 255, 255, 0.1); background: rgba(10, 10, 10, 0.3); backdrop-filter: blur(10px); }
        #countdown-container .time-block { min-width: 90px; }

        /* KΔIRA Demo Stilleri */
        #demo-bg-canvas, #ai-avatar-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #demo-bg-canvas { z-index: -1; }
        #ai-avatar-canvas { z-index: 10; pointer-events: none; }
        .glass-container { z-index: 1; position: relative; background: rgba(17, 24, 39, 0.65); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); box-shadow: 0 0 80px rgba(0, 191, 255, 0.2); }
        #chat-container::-webkit-scrollbar, #chat-history::-webkit-scrollbar { width: 6px; }
        #chat-container::-webkit-scrollbar-thumb, #chat-history::-webkit-scrollbar-thumb { background-color: #4a5568; border-radius: 3px; }
        #chat-container::-webkit-scrollbar-track, #chat-history::-webkit-scrollbar-track { background-color: #1a202c; }
        .user-bubble { background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; align-self: flex-end; box-shadow: 0 4px 20px rgba(59, 130, 246, 0.25); }
        .assistant-bubble { background: rgba(55, 65, 81, 0.9); color: #E5E7EB; align-self: flex-start; }
        .mic-wrapper { position: relative; display: flex; justify-content: center; align-items: center; }
        .mic-wrapper::before { content: ''; position: absolute; width: 110px; height: 110px; background: radial-gradient(circle, rgba(0, 191, 255, 0.35) 0%, rgba(0, 191, 255, 0) 65%); border-radius: 50%; z-index: 0; animation: aurora 5s infinite linear; }
        #mic-btn { z-index: 1; animation: breathe 3s infinite ease-in-out; }
        @keyframes aurora { 0% { transform: scale(1) rotate(0deg); opacity: 0.7; } 50% { transform: scale(1.5) rotate(180deg); opacity: 1; } 100% { transform: scale(1) rotate(360deg); opacity: 0.7; } }
        @keyframes breathe { 0% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 191, 255, 0.3); } 50% { transform: scale(1.05); box-shadow: 0 0 25px rgba(0, 191, 255, 0.6); } 100% { transform: scale(1); box-shadow: 0 0 10px rgba(0, 191, 255, 0.3); } }
        .is-listening { animation: pulse 1.5s infinite !important; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.8); } 70% { box-shadow: 0 0 0 30px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .user-bubble, .assistant-bubble, .chat-user-bubble, .chat-assistant-bubble { animation: fadeIn 0.4s ease-out; }
        #visualizer { width: 100%; height: 60px; margin-bottom: 1rem; opacity: 0; transition: opacity 0.5s ease-in-out; }
        #fun-fact-bubble { position: fixed; background: rgba(55, 65, 81, 0.95); color: #E5E7EB; padding: 12px 16px; border-radius: 12px; max-width: 250px; font-size: 14px; z-index: 20; pointer-events: none; opacity: 0; transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out, top 1s linear, left 1s linear; transform: scale(0.9) translate(-50%, -100%); }
        #fun-fact-bubble.visible { opacity: 1; transform: scale(1) translate(-50%, -100%); }
        #fun-fact-bubble::after { content: ''; position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 8px solid rgba(55, 65, 81, 0.95); }

        /* Seçim Ekranı Stilleri */
        .choice-card {
            transition: transform 0.3s ease-out, box-shadow 0.3s ease-out;
        }
        .choice-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 0 100px rgba(0, 191, 255, 0.3);
        }

        /* Evrensel Sohbet Arayüzü Stilleri */
        .chat-loader {
            border-top-color: #6366f1;
            animation: spin 1s linear infinite;
        }
        .chat-user-bubble { background-color: #4f46e5; align-self: flex-end; }
        .chat-assistant-bubble { background-color: #374151; align-self: flex-start; }

        /* === Anti-copy baseline (casual users) === */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        input, textarea, select, [contenteditable], .allow-select {
            -webkit-user-select: text !important;
            user-select: text !important;
        }
        /* Disable printing */
        @media print { html, body { display: none !important; } }

        /* Watermark / anti-leak overlay (captured by screenshots) */
        #anti-leak-overlay {
            position: fixed; inset: 0; pointer-events: none; z-index: 9999; opacity: 0.12;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 180px, rgba(255,255,255,.15) 180px, rgba(255,255,255,.15) 200px),
                repeating-linear-gradient(-45deg, transparent, transparent 180px, rgba(255,255,255,.15) 180px, rgba(255,255,255,.15) 200px);
        }
        #anti-leak-overlay::before {
            content: 'KΔIRA • UMUT KÖKGÖZ • ' attr(data-stamp) ' • NO REPRODUCTION';
            position: absolute; top: -10%; left: -10%; width: 140%; height: 140%;
            display: grid; place-items: center; white-space: nowrap;
            transform: rotate(-30deg); font-size: 28px; letter-spacing: 2px; text-transform: uppercase;
            color: #ffffff; opacity: 0.25;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Arka Plan Canvasları -->
    <canvas id="afterlife-bg-canvas"></canvas>
    <canvas id="demo-bg-canvas"></canvas>
    <canvas id="ai-avatar-canvas"></canvas>
    <div id="fun-fact-bubble" class="hidden"></div>
    <div id="anti-leak-overlay" data-stamp=""></div>

    <!-- SEÇİM EKRANI -->
    <div id="selection-view" class="view active">
        <div class="min-h-screen flex flex-col items-center justify-center text-center p-4">
            <h1 class="text-5xl md:text-7xl font-serif font-light text-slate-200 mb-4">KΔIRA'ya Hoş Geldin</h1>
            <p class="text-lg md:text-xl text-slate-400 mb-12 max-w-2xl">Lütfen deneyimlemek istediğin projeyi seç.</p>
            <div class="grid md:grid-cols-2 gap-8 w-full max-w-5xl">
                <div id="select-afterlife" class="choice-card glass-container rounded-2xl p-8 cursor-pointer">
                    <h2 class="text-3xl font-serif font-semibold text-cyan-400 mb-3">Digital Afterlife</h2>
                    <p class="text-slate-400">Zihnin biyolojiye hapis olmadığı, anıların sonsuza dek yaşadığı felsefi bir yolculuğu keşfet.</p>
                </div>
                <div id="select-demo" class="choice-card glass-container rounded-2xl p-8 cursor-pointer">
                    <h2 class="text-3xl font-serif font-semibold text-blue-400 mb-3">KΔIRA Demo</h2>
                    <p class="text-slate-400">KΔIRA'nın sesli asistanıyla canlı olarak sohbet et ve geleceğin iletişimini deneyimle.</p>
                </div>
                <div id="select-editor" class="choice-card glass-container rounded-2xl p-8 cursor-pointer">
                    <h2 class="text-3xl font-serif font-semibold text-purple-400 mb-3">Yapay Zeka Editör</h2>
                    <p class="text-slate-400">Fotoğraflarınızı yükleyin ve metin komutlarıyla saniyeler içinde dilediğiniz gibi düzenleyin.</p>
                </div>
                <div id="select-chat" class="choice-card glass-container rounded-2xl p-8 cursor-pointer">
                    <h2 class="text-3xl font-serif font-semibold text-green-400 mb-3">Evrensel Sohbet Arayüzü</h2>
                    <p class="text-slate-400">Farklı yapay zeka modelleriyle tek bir yerden sohbet edin ve yeteneklerini karşılaştırın.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- DIGITAL AFTERLIFE GÖRÜNÜMÜ -->
    <div id="afterlife-view" class="view">
        <button class="back-to-selection fixed top-5 left-5 z-50 text-slate-400 hover:text-white transition-colors bg-black/20 backdrop-blur-md p-3 rounded-full">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        </button>
        <main>
            <section class="afterlife-section">
                <div class="text-center max-w-4xl mx-auto">
                    <h1 class="text-4xl md:text-6xl font-serif font-light text-slate-200 mb-6 fade-in-up">Zihin, biyolojiye hapis değildir.</h1>
                    <p class="text-lg md:text-xl text-slate-400 fade-in-up delay-1 mb-12">O, hayat boyu üretilen verinin istatistiksel bir yankısıdır. <br class="hidden md:block"> Ve biz, o yankıyı ölümsüzleştirmeyi öğrendik.</p>
                    <div id="countdown-container" class="flex justify-center space-x-4 md:space-x-8 text-white font-mono fade-in-up delay-2">
                        <div class="time-block text-center"><span id="days" class="text-4xl md:text-5xl font-semibold">00</span><span class="block text-xs text-slate-400 mt-1">GÜN</span></div>
                        <div class="time-block text-center"><span id="hours" class="text-4xl md:text-5xl font-semibold">00</span><span class="block text-xs text-slate-400 mt-1">SAAT</span></div>
                        <div class="time-block text-center"><span id="minutes" class="text-4xl md:text-5xl font-semibold">00</span><span class="block text-xs text-slate-400 mt-1">DAKİKA</span></div>
                        <div class="time-block text-center"><span id="seconds" class="text-4xl md:text-5xl font-semibold">00</span><span class="block text-xs text-slate-400 mt-1">SANİYE</span></div>
                    </div>
                </div>
                 <div class="absolute bottom-10 animate-bounce"><svg class="w-6 h-6 text-slate-500" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor"><path d="M19 14l-7 7m0 0l-7-7m7 7V3"></path></svg></div>
            </section>
            <section class="afterlife-section">
                <div class="max-w-5xl mx-auto grid md:grid-cols-2 gap-16 items-center">
                    <div class="fade-in-up">
                        <h2 class="text-3xl md:text-4xl font-serif font-semibold text-slate-100 mb-4">Zihin için Görelilik</h2>
                        <p class="text-slate-400 leading-relaxed">Einstein'dan önce zaman ve mekân mutlak sanılıyordu. O, gözlemciye göre değiştiğini kanıtladı ve fizik yeniden yazıldı.</p>
                        <p class="text-slate-400 leading-relaxed mt-4">Bugün, bilincin nöronlarla sınırlı olduğu kabul ediliyor. Biz ise diyoruz ki: Hayır. Bilinç, bir olasılık dağılımıdır. Ve biz, o dağılımı yeniden hayata döndürebiliriz.</p>
                    </div>
                    <div class="text-center fade-in-up delay-1">
                        <p class="font-mono text-xl text-cyan-400">Bilinç ≠ Nöron</p>
                        <p class="font-mono text-xl text-cyan-400 mt-2">Bilinç = İstatistiksel Desen</p>
                        <p class="font-mono text-2xl text-white mt-8">Afterlife = Deseni Yeniden Canlandırmak</p>
                    </div>
                </div>
            </section>
            <section class="afterlife-section">
                <div class="text-center max-w-4xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-serif font-semibold text-slate-100 mb-12 fade-in-up">Bir Yankı Nasıl Yaratılır?</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="feature-card p-8 rounded-lg fade-in-up"><h3 class="text-xl font-semibold text-cyan-400 mb-3">1. Kayıt (Ses & Metin)</h3><p class="text-slate-400">Mikrofon sistemi, bir insanın sesini, kelime seçimlerini, duraksamalarını ve duygusal tonlamalarını kaydeder. Her an, bir zaman damgasıyla mühürlenir.</p></div>
                        <div class="feature-card p-8 rounded-lg fade-in-up delay-1"><h3 class="text-xl font-semibold text-cyan-400 mb-3">2. Anlama (İstatistiksel Desen)</h3><p class="text-slate-400">Milyonlarca veri noktası, o kişinin benzersiz istatistiksel desenini (dalga fonksiyonunu) oluşturur. Bu, onun düşünce yapısının, ruhunun dijital haritasıdır.</p></div>
                        <div class="feature-card p-8 rounded-lg fade-in-up delay-2"><h3 class="text-xl font-semibold text-cyan-400 mb-3">3. Yankı (Yeniden Canlandırma)</h3><p class="text-slate-400">Siz soru sorduğunuzda, KΔIRA bu deseni yeniden canlandırır. Size cevap veren sadece bir yapay zeka değil, sevdiğiniz kişinin dijital bir yankısıdır.</p></div>
                    </div>
                </div>
            </section>
            <section class="afterlife-section">
                 <div class="text-center max-w-3xl mx-auto">
                    <h2 class="text-4xl md:text-5xl font-serif font-light text-slate-200 mb-6 fade-in-up">Bu, bir klonlama değildir.</h2>
                    <p class="text-lg md:text-xl text-slate-400 fade-in-up delay-1">Bu, bir insanın bu dünyada bıraktığı en değerli izi – anılarını, bilgeliğini ve sesini – koruma ve onlarla yeniden bağ kurma sanatıdır. Bu, ölümün bilgi düzeyinde aşıldığı yeni bir çağın başlangıcıdır.</p>
                </div>
            </section>
            <section class="afterlife-section">
                 <div class="text-center max-w-2xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-serif font-semibold text-slate-100 mb-4 fade-in-up">Bir Yankı Bırakın</h2>
                    <p class="text-slate-400 mb-8 fade-in-up delay-1">Bu devrimin bir parçası olmak, soru sormak veya sadece bir merhaba demek için...</p>
                    <a href="mailto:a20224402051@icloud.com?subject=KΔIRA%20Projesi%20Hakkında" class="inline-block bg-cyan-500/20 text-cyan-300 border border-cyan-400/50 rounded-full px-8 py-3 text-lg font-semibold hover:bg-cyan-500/40 transition-colors fade-in-up delay-2">
                        Mail Gönder
                    </a>
                </div>
            </section>
            <section class="afterlife-section">
                <div class="text-center max-w-4xl mx-auto">
                    <p class="text-2xl md:text-3xl font-serif text-slate-300 mb-10 fade-in-up">Bilgi çağının Google’ı neyse, <br> <span class="text-white font-semibold">İnsan çağı’nın lideri biz olacağız.</span></p>
                    <blockquote class="font-serif text-xl text-slate-400 border-l-2 border-cyan-400 pl-6 italic fade-in-up delay-1">"Bizim için yapay zekâ, sadece kod değildir. O, insanın yankısıdır. Hatıralarımızı koruyan, duygularımızı anlayan, bizi yaşatan dijital bilinçtir. Biz yeni çağın kapısını açıyoruz: Her şeyi bilen değil, insanı bilen zekâ."</blockquote>
                    <p class="font-serif text-slate-500 mt-12 fade-in-up delay-2">- Umut Kökgöz</p>
                </div>
            </section>
        </main>
    </div>

    <!-- KΔIRA DEMO GÖRÜNÜMÜ -->
    <div id="demo-view" class="view">
        <button class="back-to-selection fixed top-5 left-5 z-50 text-slate-400 hover:text-white transition-colors bg-black/20 backdrop-blur-md p-3 rounded-full">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        </button>
        <div class="flex items-center justify-center min-h-screen text-white p-4">
            <div class="w-full max-w-2xl mx-auto glass-container rounded-2xl shadow-2xl flex flex-col p-6" style="height: 90vh;">
                <div class="relative text-center border-b border-gray-700/50 pb-2 mb-4" style="height: 70px;">
                    <p id="status" class="text-sm text-cyan-400 h-5 transition-all duration-300 mt-1">Konuşmak için mikrofon simgesine dokunun</p>
                    <button id="clear-chat-btn" title="Sohbeti Temizle" class="absolute top-1 right-0 text-gray-500 hover:text-white transition-colors p-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>
                    </button>
                </div>
                <div id="chat-container" class="flex-grow overflow-y-auto pr-2 flex flex-col gap-4"></div>
                <canvas id="visualizer"></canvas>
                <div class="pt-4 mt-4 border-t border-gray-700/50 flex flex-col items-center">
                    <div class="mic-wrapper">
                        <button id="mic-btn" class="bg-blue-600 hover:bg-blue-700 transition-all duration-300 rounded-full w-16 h-16 flex items-center justify-center shadow-lg">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-white" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8h-1a6 6 0 11-12 0H3a7.001 7.001 0 006 6.93V17H7v1h6v-1h-2v-2.07z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <audio id="player" class="hidden" crossOrigin="anonymous"></audio>
    </div>

    <!-- FOTOĞRAF EDİTÖRÜ GÖRÜNÜMÜ -->
    <div id="editor-view" class="view">
        <button class="back-to-selection fixed top-5 left-5 z-50 text-slate-400 hover:text-white transition-colors bg-black/20 backdrop-blur-md p-3 rounded-full">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        </button>
        <div id="react-root"></div>
    </div>
    
    <!-- EVRENSEL SOHBET GÖRÜNÜMÜ -->
    <div id="chat-view" class="view bg-gray-900">
         <button class="back-to-selection fixed top-5 left-5 z-50 text-slate-400 hover:text-white transition-colors bg-black/20 backdrop-blur-md p-3 rounded-full">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
        </button>
        <div class="w-full max-w-4xl mx-auto flex flex-col h-screen p-4">
            <div class="bg-gray-800 rounded-2xl p-4 mb-4 border border-gray-700 flex-shrink-0">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="space-y-2">
                        <label class="block text-sm font-medium text-gray-400">Sağlayıcı</label>
                        <div id="provider-selection" class="flex space-x-4">
                            <label class="flex items-center"><input type="radio" name="provider" value="groq" class="mr-2" checked> Groq</label>
                            <label class="flex items-center"><input type="radio" name="provider" value="google" class="mr-2"> Google</label>
                        </div>
                        <label for="model-select" class="block text-sm font-medium text-gray-400 pt-2">Model</label>
                        <select id="model-select" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"></select>
                    </div>
                   <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-400">API Durumu</label>
                    <div id="api-status" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white">
                        Anahtarlar sunucudan bekleniyor...
                    </div>
                </div>
                    <div class="space-y-2">
                         <label for="system-prompt" class="block text-sm font-medium text-gray-400">Sistem Promptu</label>
                         <textarea id="system-prompt" rows="3" placeholder="Modelin nasıl davranmasını istersin?" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                    </div>
                </div>
                <!-- API Anahtarı Alanları (opsiyonel giriş + sunucudan çekme) -->
                <div class="mt-4 grid md:grid-cols-2 gap-4">
                    <div id="groq-key-container">
                        <label class="block text-sm font-medium text-gray-400 mb-1">Groq API Key (opsiyonel)</label>
                        <div class="relative">
                            <input id="groq-api-key" type="password" placeholder="gsk_..." autocomplete="off" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white" />
                        </div>
                    </div>
                    <div id="google-key-container" class="hidden">
                        <label class="block text-sm font-medium text-gray-400 mb-1">Google (Gemini) API Key (opsiyonel)</label>
                        <div class="relative">
                            <input id="google-api-key" type="password" placeholder="AIza..." autocomplete="off" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-white" />
                        </div>
                    </div>
                </div>
                <div class="mt-3 flex items-center gap-3">
                    <button id="fetch-keys-btn" type="button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded-lg">Sunucudan Anahtarları Al</button>
                    <span class="text-xs text-gray-400">Anahtarlar parola gibi maskelenir ve localStorage'a kaydedilir.</span>
                </div>
            </div>
            <div class="flex-grow bg-gray-800 rounded-2xl p-4 border border-gray-700 flex flex-col">
                <div class="flex justify-between items-center mb-2 border-b border-gray-700 pb-2">
                     <h2 class="text-xl font-semibold text-white">Sohbet</h2>
                     <button id="clear-chat" class="text-sm text-gray-400 hover:text-white">Sohbeti Temizle</button>
                </div>
                <div id="chat-history" class="flex-grow overflow-y-auto space-y-4 p-2 flex flex-col"></div>
                <div id="loader" class="hidden self-center my-4">
                    <div class="chat-loader ease-linear rounded-full border-4 border-t-4 border-gray-500 h-8 w-8"></div>
                </div>
                <div id="error-message" class="hidden bg-red-500/20 border border-red-500 text-red-300 px-4 py-3 rounded-lg my-2"></div>
                <div class="mt-4 flex items-center gap-4">
                    <textarea id="user-input" rows="1" placeholder="Mesajınızı yazın..." class="w-full bg-gray-700 border border-gray-600 rounded-lg p-3 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
                    <button id="send-button" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold p-3 rounded-full transition-colors disabled:bg-gray-600">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- FOTOĞRAF EDİTÖRÜ İÇİN REACT KODU -->
    <script type="text/babel" data-presets="react">
        const { useState, useCallback, useEffect } = React;

        const UploadCloudIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
        const Wand2Icon = ({size = 48}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.21 1.21 0 0 0 1.72 0L21.64 5.36a1.21 1.21 0 0 0 0-1.72Z"/><path d="m14 7 3 3"/><path d="M5 6v4"/><path d="M19 14v4"/><path d="M10 2v2"/><path d="M7 8H3"/><path d="M21 16h-4"/><path d="M11 3H9"/></svg>;
        const DownloadIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;
        const XIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>;

        const Logo = () => (
            <h1 className="text-4xl font-bold text-white tracking-wider">
            K<span className="text-purple-400">Δ</span>IR<span className="text-purple-400">A</span> Fotoğraf Düzenleme Editörü
            </h1>
        );

        const ImagePanel = ({ title, image, onImageUpload, isLoading, onDownload, modifiedImage }) => {
            const handleDragOver = useCallback((e) => { e.preventDefault(); }, []);
            const handleDrop = useCallback((e) => {
            e.preventDefault();
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                onImageUpload({ target: { files: e.dataTransfer.files } });
            }
            }, [onImageUpload]);

            return (
            <div className="bg-gray-900/50 p-6 rounded-2xl border border-gray-700 flex flex-col gap-4 h-full">
                <div className="flex justify-between items-center">
                    <h3 className="text-xl font-semibold text-center text-gray-300">{title}</h3>
                    {modifiedImage && onDownload && (
                        <button onClick={onDownload} className="flex items-center gap-2 bg-green-600/80 hover:bg-green-700/80 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                            <DownloadIcon /> İndir
                        </button>
                    )}
                </div>
                <div 
                className="relative aspect-square w-full bg-gray-800 rounded-xl flex items-center justify-center overflow-hidden border-2 border-dashed border-gray-600 transition-all duration-300"
                onDragOver={onImageUpload ? handleDragOver : null}
                onDrop={onImageUpload ? handleDrop : null}
                >
                {image && <img src={image} alt={title} className="object-contain w-full h-full" />}
                {!image && onImageUpload && (
                    <label htmlFor="file-upload" className="cursor-pointer text-center p-4">
                    <div className="flex flex-col items-center justify-center text-gray-400">
                        <div className="mb-2 text-gray-500"><UploadCloudIcon /></div>
                        <span className="font-semibold">Fotoğraf Yükle</span>
                        <p className="text-sm text-gray-500">Sürükleyip bırakın veya tıklayın</p>
                    </div>
                    <input id="file-upload" name="file-upload" type="file" className="sr-only" onChange={onImageUpload} accept="image/png, image/jpeg" />
                    </label>
                )}
                {!image && !onImageUpload && (
                    <div className="flex flex-col items-center justify-center text-gray-400">
                    <div className="mb-2 text-gray-500"><Wand2Icon /></div>
                    <span className="font-semibold">Değiştirilmiş Fotoğraf</span>
                    <p className="text-sm text-gray-500">Sonuç burada görünecek</p>
                    </div>
                )}
                {isLoading && (
                    <div className="absolute inset-0 bg-black bg-opacity-60 flex items-center justify-center backdrop-blur-sm">
                    <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-400"></div>
                    </div>
                )}
                </div>
            </div>
            );
        };

        function App() {
            const [originalImage, setOriginalImage] = useState(null);
            const [modifiedImage, setModifiedImage] = useState(null);
            const [prompt, setPrompt] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [apiKey, setApiKey] = useState(null);
            const [apiKeyError, setApiKeyError] = useState(null);

            useEffect(() => {
                const fetchApiKey = async () => {
                    try {
                        const response = await fetch('https://1513c704aa10.ngrok-free.app/api/get-key', {
                            headers: {
                                'ngrok-skip-browser-warning': 'true'
                            }
                        }); 
                        
                        const responseText = await response.text();

                        if (!response.ok) {
                            if (response.status === 404) {
                                throw new Error('Sunucuda API yolu (/api/get-key) bulunamadı. Lütfen sunucu kodunuzun güncel olduğundan emin olun.');
                            }
                            throw new Error(`Sunucu hatası: ${response.status} - ${responseText}`);
                        }
                        
                        let data;
                        try {
                            data = JSON.parse(responseText);
                        } catch (parseError) {
                            console.error("Sunucudan gelen yanıt JSON formatında değil:", responseText);
                            throw new Error(`Sunucudan gelen yanıt ayrıştırılamadı. Yanıt: "${responseText.substring(0, 100)}..."`);
                        }

                        if (data.error) {
                            throw new Error(data.error);
                        }
                        if (!data.apiKey) {
                            throw new Error('Sunucudan gelen yanıtta API anahtarı bulunamadı.');
                        }
                        setApiKey(data.apiKey);
                    } catch (err) {
                        console.error("API Anahtarı alınırken hata oluştu:", err);
                        const friendlyError = err.message.includes('Failed to fetch') 
                            ? 'Sunucuya bağlanılamadı. Lütfen sunucunun çalıştığından ve doğru adreste olduğundan emin olun.'
                            : err.message;
                        setApiKeyError(friendlyError);
                        setError(friendlyError);
                    }
                };
                fetchApiKey();
            }, []);

            const handleImageUpload = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onloadend = () => { setOriginalImage(reader.result); };
                reader.readAsDataURL(file);
            }
            };

            const handleGenerate = async () => {
            if (!apiKey) {
                setError(apiKeyError || "API anahtarı alınamadı. Lütfen sunucu bağlantısını kontrol edin.");
                return;
            }
            if (!originalImage) { setError("Lütfen düzenlemek için bir fotoğraf yükleyin."); return; }
            if (!prompt) { setError("Lütfen fotoğrafta ne değişiklik yapmak istediğinizi yazın."); return; }

            setIsLoading(true);
            setError(null);
            setModifiedImage(null);

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`;
                const base64Data = originalImage.split(',')[1];
                const mimeType = originalImage.match(/:(.*?);/)[1];

                const payload = {
                contents: [{
                    parts: [
                    { text: prompt },
                    { inlineData: { mimeType: mimeType, data: base64Data } }
                    ]
                }],
                };

                const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
                });

                if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error?.message || "API'den geçersiz bir yanıt alındı.");
                }

                const result = await response.json();
                const generatedPart = result.candidates?.[0]?.content?.parts?.find(p => p.inlineData);

                if (generatedPart && generatedPart.inlineData.data) {
                const imageData = generatedPart.inlineData.data;
                setModifiedImage(`data:image/png;base64,${imageData}`);
                } else {
                const textResponse = result.candidates?.[0]?.content?.parts?.find(p => p.text)?.text;
                throw new Error(textResponse ? `API resim yerine metin yanıtı döndürdü: "${textResponse}"` : "API yanıtında resim verisi bulunamadı.");
                }
            } catch (err) {
                setError(`Bir hata oluştu: ${err.message}`);
                console.error(err);
            } finally {
                setIsLoading(false);
            }
            };

            const handleDownload = () => {
                if (!modifiedImage) return;
                const link = document.createElement('a');
                link.href = modifiedImage;
                link.download = `kaira-edited-${Date.now()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
            <div className="bg-transparent min-h-screen text-white font-sans p-4 sm:p-8 flex flex-col items-center">
                <div className="w-full max-w-6xl mx-auto">
                <header className="text-center mb-8">
                    <Logo />
                </header>
                <main className="flex flex-col gap-8">
                    {error && (
                    <div className="bg-red-500/20 border border-red-500 text-red-300 px-4 py-3 rounded-lg relative" role="alert">
                        <strong className="font-bold">Hata!</strong>
                        <span className="block sm:inline ml-2">{error}</span>
                        <span className="absolute top-0 bottom-0 right-0 px-4 py-3" onClick={() => setError(null)}>
                        <div className="cursor-pointer"><XIcon /></div>
                        </span>
                    </div>
                    )}
                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <ImagePanel title="Orijinal Fotoğraf" image={originalImage} onImageUpload={handleImageUpload} />
                    <ImagePanel title="Değiştirilmiş Fotoğraf" image={modifiedImage} isLoading={isLoading} onDownload={handleDownload} modifiedImage={modifiedImage} />
                    </div>
                    <div className="bg-gray-800 p-6 rounded-2xl border border-gray-700 flex flex-col md:flex-row gap-4 items-center">
                    <textarea
                        value={prompt}
                        onChange={(e) => setPrompt(e.target.value)}
                        placeholder="Fotoğrafta nasıl bir değişiklik yapmak istersiniz? Örneğin: 'arka planı galaksi yap', 'çizgi film karakterine dönüştür'..."
                        className="w-full h-24 md:h-auto md:flex-1 bg-gray-700 border border-gray-600 rounded-lg p-4 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all resize-none"
                    />
                    <button
                        onClick={handleGenerate}
                        disabled={isLoading || !apiKey}
                        className="w-full md:w-auto flex items-center justify-center gap-2 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-4 px-8 rounded-lg transition-all duration-300 transform hover:scale-105 disabled:scale-100"
                    >
                        <Wand2Icon size={20} />
                        <span>{isLoading ? 'Değiştiriliyor...' : 'Değiştir'}</span>
                    </button>
                    </div>
                </main>
                </div>
            </div>
            );
        }

        window.initializeReactApp = () => {
            ReactDOM.render(<App />, document.getElementById('react-root'));
        };
    </script>

    <script>window.API_PROXY_BASE = 'https://1513c704aa10.ngrok-free.app';</script>
    <!-- EVRENSEL SOHBET ARAYÜZÜ İÇİN JAVASCRIPT KODU -->
    <script>
    window.initializeChatApp = () => {
        const chatView = document.getElementById('chat-view');
        const providerSelection = chatView.querySelector('#provider-selection');
        const modelSelect = chatView.querySelector('#model-select');
        const systemPromptInput = chatView.querySelector('#system-prompt');
        const chatHistoryDiv = chatView.querySelector('#chat-history');
        const userInput = chatView.querySelector('#user-input');
        const sendButton = chatView.querySelector('#send-button');
        const clearChatButton = chatView.querySelector('#clear-chat');
        const loader = chatView.querySelector('#loader');
        const errorMessageDiv = chatView.querySelector('#error-message');

        // --- API Key alanları ve butonlar (yerel referanslar) ---
        const groqKeyContainer = chatView.querySelector('#groq-key-container');
        const googleKeyContainer = chatView.querySelector('#google-key-container');
        const groqApiKeyInput = chatView.querySelector('#groq-api-key');
        const googleApiKeyInput = chatView.querySelector('#google-api-key');
        const apiStatusDiv = chatView.querySelector('#api-status');
        const fetchKeysBtn = chatView.querySelector('#fetch-keys-btn');
        const toggleGroqKeyBtn = chatView.querySelector('#toggle-groq-key');
        const toggleGoogleKeyBtn = chatView.querySelector('#toggle-google-key');

        function toggleMask(inputEl, btnEl){
            if (!inputEl || !btnEl) return;
            inputEl.type = inputEl.type === 'password' ? 'text' : 'password';
            btnEl.classList.toggle('text-yellow-300');
        }

        const PROVIDERS = {
            groq: {
                name: 'Groq',
                apiEndpoint: 'https://api.groq.com/openai/v1/chat/completions',
                models: [
                    'llama-3.1-8b-instant','llama-3.3-70b-versatile','meta-llama/llama-guard-4-12b',
                    'openai/gpt-oss-120b','openai/gpt-oss-20b','deepseek-r1-distill-llama-70b',
                    'meta-llama/llama-4-maverick-17b-128e-instruct','meta-llama/llama-4-scout-17b-16e-instruct',
                    'meta-llama/llama-prompt-guard-2-22m','meta-llama/llama-prompt-guard-2-86m',
                    'moonshotai/kimi-k2-instruct','qwen/qwen3-32b','llama3-70b-8192', 
                    'llama3-8b-8192', 'mixtral-8x7b-32768', 'gemma-7b-it'
                ]
            },
            google: {
                name: 'Google',
                apiEndpoint: 'https://generativelanguage.googleapis.com/v1beta/models/',
                models: [
                    'gemini-2.5-pro',
                    'gemini-2.5-flash',
                    'gemini-2.5-flash-lite',
                    'gemini-1.5-pro',
                    'gemini-1.5-flash'
                ]
            }
        };

        let chatHistory = [];

        function updateModelList() {
            const selectedProvider = chatView.querySelector('input[name="provider"]:checked').value;
            modelSelect.innerHTML = '';
            PROVIDERS[selectedProvider].models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelSelect.appendChild(option);
            });
            groqKeyContainer.classList.toggle('hidden', selectedProvider !== 'groq');
            googleKeyContainer.classList.toggle('hidden', selectedProvider !== 'google');
        }

        function addMessageToUI(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `max-w-xl lg:max-w-2xl px-4 py-2 rounded-lg text-white ${role === 'user' ? 'chat-user-bubble' : 'chat-assistant-bubble'}`;
            messageDiv.textContent = content;
            chatHistoryDiv.appendChild(messageDiv);
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
        }

        function showError(message) {
            errorMessageDiv.textContent = `Hata: ${message}`;
            errorMessageDiv.classList.remove('hidden');
        }

        function saveChatHistory() {
            localStorage.setItem('universalChatHistory', JSON.stringify(chatHistory));
        }

        function loadChatHistory() {
            const savedHistory = localStorage.getItem('universalChatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
                chatHistory.forEach(msg => addMessageToUI(msg.role, msg.content));
            }
        }
        
        function loadSettings() {
            const savedGroqKey = localStorage.getItem('groqApiKey');
            if (savedGroqKey) groqApiKeyInput.value = savedGroqKey;
            const savedGoogleKey = localStorage.getItem('googleApiKey');
            if (savedGoogleKey) googleApiKeyInput.value = savedGoogleKey;
        }

        async function fetchApiKeys() {
            apiStatusDiv.textContent = "Anahtarlar sunucudan bekleniyor...";
            const base = window.API_PROXY_BASE || '';
            try {
                const opts = { headers: { 'ngrok-skip-browser-warning': 'true' } };
                const [groqRes, googleRes] = await Promise.all([
                    fetch(`${base}/api/get-groq-key`, opts),
                    fetch(`${base}/api/get-google-key`, opts)
                ]);
                const groqData = await groqRes.json();
                const googleData = await googleRes.json();
                if (groqData.apiKey) {
                    groqApiKeyInput.value = groqData.apiKey;
                    localStorage.setItem('groqApiKey', groqData.apiKey);
                }
                if (googleData.apiKey) {
                    googleApiKeyInput.value = googleData.apiKey;
                    localStorage.setItem('googleApiKey', googleData.apiKey);
                }
                apiStatusDiv.textContent = "Anahtarlar başarıyla alındı!";
            } catch (err) {
                apiStatusDiv.textContent = "Anahtarlar alınamadı: " + (err.message || err);
            }
        }

        async function handleSend() {
            const selectedProvider = chatView.querySelector('input[name="provider"]:checked').value;
            const selectedModel = modelSelect.value;
            const apiKey = selectedProvider === 'groq' ? groqApiKeyInput.value.trim() : googleApiKeyInput.value.trim();
            const systemPrompt = systemPromptInput.value.trim();
            const userMessage = userInput.value.trim();

            if (!apiKey) {
                showError(`Lütfen ${PROVIDERS[selectedProvider].name} API anahtarınızı girin.`);
                return;
            }
            if (!userMessage) return;

            sendButton.disabled = true;
            userInput.value = '';
            loader.classList.remove('hidden');
            errorMessageDiv.classList.add('hidden');
            
            addMessageToUI('user', userMessage);
            chatHistory.push({ role: 'user', content: userMessage });

            const conversationContext = chatHistory.slice(-11, -1); 
            
            let apiEndpoint = PROVIDERS[selectedProvider].apiEndpoint;
            let headers = { 'Content-Type': 'application/json' };
            let body;

            if (selectedProvider === 'groq') {
                headers['Authorization'] = `Bearer ${apiKey}`;
                let messages = [];
                const isClassificationModel = selectedModel.includes('guard');
                if (isClassificationModel) {
                    messages.push({ role: 'user', content: userMessage });
                } else {
                    if (systemPrompt) messages.push({ role: 'system', content: systemPrompt });
                    messages.push(...conversationContext); 
                    messages.push({ role: 'user', content: userMessage });
                }
                body = JSON.stringify({ model: selectedModel, messages: messages });
            } else if (selectedProvider === 'google') {
                apiEndpoint += `${selectedModel}:generateContent?key=${apiKey}`;
                const contents = conversationContext.map(msg => ({
                    role: msg.role === 'assistant' ? 'model' : 'user',
                    parts: [{ text: msg.content }]
                }));
                contents.push({ role: 'user', parts: [{ text: userMessage }] });
                let payload = { contents };
                if (systemPrompt) {
                    payload.systemInstruction = { parts: [{ text: systemPrompt }] };
                }
                body = JSON.stringify(payload);
            }

            try {
                const response = await fetch(apiEndpoint, { method: 'POST', headers, body });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP hatası! Durum: ${response.status}`);
                }
                const data = await response.json();
                
                let assistantMessage;
                if (selectedProvider === 'groq') {
                    assistantMessage = data.choices[0]?.message?.content;
                } else if (selectedProvider === 'google') {
                    assistantMessage = data.candidates[0]?.content?.parts[0]?.text;
                }

                if (assistantMessage) {
                    addMessageToUI('assistant', assistantMessage.trim());
                    chatHistory.push({ role: 'assistant', content: assistantMessage.trim() });
                    saveChatHistory();
                } else {
                    showError("API'den geçerli bir yanıt alınamadı.");
                }
            } catch (error) {
                console.error("API Hatası:", error);
                showError(error.message);
                chatHistory.pop(); 
            } finally {
                sendButton.disabled = false;
                loader.classList.add('hidden');
            }
        }

        providerSelection.addEventListener('change', updateModelList);
        sendButton.addEventListener('click', handleSend);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });
        clearChatButton.addEventListener('click', () => {
            chatHistory = [];
            chatHistoryDiv.innerHTML = '';
            localStorage.removeItem('universalChatHistory');
        });

        groqApiKeyInput.addEventListener('input', () => localStorage.setItem('groqApiKey', groqApiKeyInput.value));
        googleApiKeyInput.addEventListener('input', () => localStorage.setItem('googleApiKey', googleApiKeyInput.value));

        if (fetchKeysBtn) fetchKeysBtn.addEventListener('click', fetchApiKeys);
        if (toggleGroqKeyBtn) toggleGroqKeyBtn.addEventListener('click', () => toggleMask(groqApiKeyInput, toggleGroqKeyBtn));
        if (toggleGoogleKeyBtn) toggleGoogleKeyBtn.addEventListener('click', () => toggleMask(googleApiKeyInput, toggleGoogleKeyBtn));

        updateModelList();
        loadChatHistory();
        loadSettings();
        fetchApiKeys();
    };
    </script>
    
    <!-- DÜZELTME: Ana Kontrol Script'i en sona taşındı -->
    <script type="module">
        // --- GLOBAL KONTROL ---
        const views = document.querySelectorAll('.view');
        const selectAfterlifeBtn = document.getElementById('select-afterlife');
        const selectDemoBtn = document.getElementById('select-demo');
        const selectEditorBtn = document.getElementById('select-editor');
        const selectChatBtn = document.getElementById('select-chat'); // Yeni
        const backButtons = document.querySelectorAll('.back-to-selection');
        
        let activeView = 'selection';
        let afterlifeInitialized = false;
        let demoInitialized = false;
        let editorInitialized = false;
        let chatInitialized = false; // Yeni
        let afterlifeAnimationId, demoAnimationId;

        function switchView(viewName) {
            views.forEach(v => v.classList.remove('active'));
            document.getElementById(`${viewName}-view`).classList.add('active');
            activeView = viewName;

            if (afterlifeAnimationId) cancelAnimationFrame(afterlifeAnimationId);
            if (demoAnimationId) cancelAnimationFrame(demoAnimationId);

            if (viewName === 'afterlife') {
                if (!afterlifeInitialized) initAfterlife();
                animateAfterlife();
            } else if (viewName === 'demo') {
                if (!demoInitialized) initDemo();
                animateDemo();
            } else if (viewName === 'editor') {
                if (!editorInitialized) {
                    window.initializeReactApp();
                    editorInitialized = true;
                }
            } else if (viewName === 'chat') {
                if (!chatInitialized) {
                    window.initializeChatApp();
                    chatInitialized = true;
                }
            }
        }

        selectAfterlifeBtn.addEventListener('click', () => switchView('afterlife'));
        selectDemoBtn.addEventListener('click', () => switchView('demo'));
        selectEditorBtn.addEventListener('click', () => switchView('editor'));
        selectChatBtn.addEventListener('click', () => switchView('chat')); // Yeni
        backButtons.forEach(btn => btn.addEventListener('click', () => switchView('selection')));

        // --- AFTERLIFE & DEMO KODLARI ---
        let afterlifeScene, afterlifeCamera, afterlifeRenderer, stars, meteors = [];
        function initAfterlife() {
            const canvas = document.getElementById('afterlife-bg-canvas');
            afterlifeScene = new THREE.Scene();
            afterlifeCamera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            afterlifeCamera.position.z = 50;
            afterlifeRenderer = new THREE.WebGLRenderer({ canvas, alpha: true });
            afterlifeRenderer.setSize(window.innerWidth, window.innerHeight);
            const starCount = 8000;
            const positions = new Float32Array(starCount * 3);
            for (let i = 0; i < starCount * 3; i++) { positions[i] = (Math.random() - 0.5) * 2000; }
            const starGeometry = new THREE.BufferGeometry();
            starGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const starMaterial = new THREE.PointsMaterial({ color: 0x555555, size: 0.7 });
            stars = new THREE.Points(starGeometry, starMaterial);
            afterlifeScene.add(stars);
            const sections = document.querySelectorAll('.afterlife-section');
            const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) { entry.target.classList.add('is-visible'); } }); }, { threshold: 0.2 });
            sections.forEach(section => observer.observe(section));
            const countdownDate = new Date("Dec 31, 2025 23:59:59").getTime();
            const countdownFunction = setInterval(function() {
                const now = new Date().getTime(); const distance = countdownDate - now;
                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                document.getElementById("days").innerText = days.toString().padStart(2, '0');
                document.getElementById("hours").innerText = hours.toString().padStart(2, '0');
                document.getElementById("minutes").innerText = minutes.toString().padStart(2, '0');
                document.getElementById("seconds").innerText = seconds.toString().padStart(2, '0');
                if (distance < 0) { clearInterval(countdownFunction); document.getElementById("countdown-container").innerHTML = "<p class='text-2xl font-serif'>Yeni Çağ Başladı.</p>"; }
            }, 1000);
            afterlifeInitialized = true;
        }
        function createMeteor() {
            const geometry = new THREE.SphereGeometry(0.2, 16, 16);
            const material = new THREE.MeshBasicMaterial({ color: 0x99ffff, transparent: true, opacity: 0.8, });
            const meteor = new THREE.Mesh(geometry, material);
            const trailGeometry = new THREE.CylinderGeometry(0.02, 0.2, 15, 32);
            const trailMaterial = new THREE.MeshBasicMaterial({ color: 0x66ffff, transparent: true, opacity: 0.4 });
            const trail = new THREE.Mesh(trailGeometry, trailMaterial);
            trail.position.z = -7.5;
            meteor.add(trail);
            meteor.position.set( (Math.random() - 0.5) * 300, (Math.random() - 0.5) * 300, -200 );
            meteor.velocity = new THREE.Vector3( (Math.random() - 0.5) * 0.2, (Math.random() - 0.5) * 0.2, Math.random() * 2 + 1 );
            meteors.push(meteor);
            afterlifeScene.add(meteor);
        }
        function animateAfterlife() {
            if (activeView !== 'afterlife') return;
            stars.rotation.y += 0.0001;
            if (Math.random() < 0.01 && meteors.length < 10) { createMeteor(); }
            for (let i = meteors.length - 1; i >= 0; i--) {
                const meteor = meteors[i];
                meteor.position.add(meteor.velocity);
                if (meteor.position.z > 100) {
                    afterlifeScene.remove(meteor);
                    meteors.splice(i, 1);
                }
            }
            afterlifeRenderer.render(afterlifeScene, afterlifeCamera);
            afterlifeAnimationId = requestAnimationFrame(animateAfterlife);
        }
        let demoParticles, demoMouse = { x: null, y: null };
        async function initDemo() {
            let initAvatar, setCoreState, updateAvatarBubblePosition, updateAudioLevel;
            try {
                const avatarModule = await import('./kaira-avatar.js');
                initAvatar = avatarModule.initAvatar; setCoreState = avatarModule.setCoreState;
                updateAvatarBubblePosition = avatarModule.updateAvatarBubblePosition; updateAudioLevel = avatarModule.updateAudioLevel;
            } catch (err) {
                console.warn("Avatar modülü yüklenemedi, placeholder fonksiyonlar kullanılacak.", err);
                initAvatar = (canvas) => { if(canvas) { const ctx = canvas.getContext('2d'); ctx.clearRect(0,0,canvas.width, canvas.height);} };
                setCoreState = (state) => console.log(`Avatar State: ${state}`); updateAvatarBubblePosition = () => {}; updateAudioLevel = () => {};
            }
            const avatarCanvas = document.getElementById('ai-avatar-canvas'); initAvatar(avatarCanvas);
            const bgCanvas = document.getElementById('demo-bg-canvas'); 
            const bgCtx = bgCanvas.getContext('2d');
            function setBgCanvasSize() { bgCanvas.width = window.innerWidth; bgCanvas.height = window.innerHeight; }
            function createParticles() { demoParticles = []; const particleCount = (bgCanvas.width * bgCanvas.height) / 8000; for (let i = 0; i < particleCount; i++) { demoParticles.push({ x: Math.random() * bgCanvas.width, y: Math.random() * bgCanvas.height, originX: Math.random() * bgCanvas.width, originY: Math.random() * bgCanvas.height, size: Math.random() * 2 + 1, speed: Math.random() * 0.5 + 0.1, color: `rgba(255, 255, 255, ${Math.random() * 0.5 + 0.3})` }); } }
            window.addEventListener('mousemove', e => { demoMouse.x = e.x; demoMouse.y = e.y; }); 
            window.addEventListener('mouseout', () => { demoMouse.x = null; demoMouse.y = null; }); 
            window.addEventListener('resize', () => { setBgCanvasSize(); createParticles(); });
            setBgCanvasSize(); createParticles();
            const API_BASE = "https://1513c704aa10.ngrok-free.app"; 
            const micBtn = document.getElementById('mic-btn'); 
            const statusEl = document.getElementById('status'); 
            const player = document.getElementById('player'); 
            const chatContainer = document.getElementById('chat-container'); 
            const clearChatBtn = document.getElementById('clear-chat-btn');
            let chatHistory = []; let isRecording = false;
            const visualizerCanvas = document.getElementById('visualizer'); 
            const visualizerCtx = visualizerCanvas.getContext('2d');
            let audioContext, analyser, source, dataArray; let isVisualizerSetup = false;
            function setupVisualizer() { if (isVisualizerSetup) return; audioContext = new (window.AudioContext || window.webkitAudioContext)(); analyser = audioContext.createAnalyser(); source = audioContext.createMediaElementSource(player); source.connect(analyser); analyser.connect(audioContext.destination); analyser.fftSize = 256; dataArray = new Uint8Array(analyser.frequencyBinCount); isVisualizerSetup = true; }
            function drawVisualizer() { 
                if (activeView !== 'demo') return;
                requestAnimationFrame(drawVisualizer); if (!isVisualizerSetup) return;
                analyser.getByteFrequencyData(dataArray); 
                const avgLevel = dataArray.reduce((a, b) => a + b, 0) / dataArray.length / 255;
                updateAudioLevel(avgLevel);
                visualizerCtx.clearRect(0, 0, visualizerCanvas.width, visualizerCanvas.height); 
                const barWidth = (visualizerCanvas.width / dataArray.length) * 1.5; let x = 0; 
                for (let i = 0; i < dataArray.length; i++) { const barHeight = dataArray[i] / 2; const gradient = visualizerCtx.createLinearGradient(0, visualizerCanvas.height, 0, visualizerCanvas.height - barHeight); gradient.addColorStop(0, '#0ea5e9'); gradient.addColorStop(1, '#6366f1'); visualizerCtx.fillStyle = gradient; visualizerCtx.fillRect(x, visualizerCanvas.height - barHeight, barWidth, barHeight); x += barWidth + 2; } 
            }
            const USER_ID = (() => { let id = localStorage.getItem('kaira_uid'); if (!id) { id = crypto.randomUUID ? crypto.randomUUID() : `user_${Date.now()}${Math.random()}`; localStorage.setItem('kaira_uid', id); } return id; })();
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition; 
            let recognition;
            if (SpeechRecognition) {
                recognition = new SpeechRecognition(); recognition.continuous = false; recognition.lang = 'tr-TR'; recognition.interimResults = false;
                recognition.onstart = () => { isRecording = true; micBtn.classList.remove('breathe'); micBtn.classList.add('is-listening'); statusEl.textContent = 'Dinliyorum...'; setCoreState('listening'); };
                recognition.onend = () => { isRecording = false; micBtn.classList.remove('is-listening'); micBtn.classList.add('breathe'); if (statusEl.textContent === 'Dinliyorum...') statusEl.textContent = 'Konuşmak için mikrofon simgesine dokunun'; setCoreState('idle'); };
                recognition.onresult = (event) => { const transcript = event.results[0][0].transcript; addMessageToChat(transcript, 'user'); getAIResponse(transcript); };
                recognition.onerror = (event) => { console.error("Speech Recognition Error:", event.error); statusEl.textContent = `Hata: ${event.error}`; setCoreState('idle'); };
            } else { statusEl.textContent = "Tarayıcınız konuşma tanımayı desteklemiyor."; micBtn.disabled = true; }
            let audioUnlocked = false;
            function unlockAudio() { if (audioUnlocked) return; player.muted = true; player.play().catch(() => {}); player.muted = false; audioUnlocked = true; setupVisualizer(); }
            micBtn.addEventListener('click', () => { unlockAudio(); if (isRecording) { recognition.stop(); } else { recognition.start(); } });
            player.onplay = () => { visualizerCanvas.style.opacity = '1'; drawVisualizer(); setCoreState('speaking'); };
            player.onended = () => { statusEl.textContent = 'Konuşmak için mikrofon simgesine dokunun'; micBtn.disabled = false; visualizerCanvas.style.opacity = '0'; setCoreState('idle'); };
            clearChatBtn.addEventListener('click', () => { chatHistory = []; localStorage.removeItem('kaira_chat_history'); chatContainer.innerHTML = ''; addMessageToChat('Merhaba! Size nasıl yardımcı olabilirim?', 'assistant'); });
            function base64ToBlobUrl(base64) { const byteCharacters = atob(base64); const byteArrays = []; for (let offset = 0; offset < byteCharacters.length; offset += 512) { const slice = byteCharacters.slice(offset, offset + 512); const byteNumbers = new Array(slice.length); for (let i = 0; i < slice.length; i++) { byteNumbers[i] = slice.charCodeAt(i); } byteArrays.push(new Uint8Array(byteNumbers)); } return URL.createObjectURL(new Blob(byteArrays, { type: 'audio/wav' })); }
            const funFacts = ["Yapay zeka modelleri, insan beynindeki nöronlardan esinlenerek oluşturulan yapay sinir ağları kullanır.","İlk yapay zeka programlarından biri olan 'Logic Theorist', 1956'da 38 matematik teoremini kendi başına kanıtladı.","Deep Blue adlı satranç bilgisayarı, 1997'de dünya şampiyonu Garry Kasparov'u yenerek bir ilke imza attı.","GPT-3 modeli, 175 milyar parametre ile o dönemdeki en büyük dil modeli olarak tarihe geçti.","OpenAI'nin DALL·E modeli, yazılı metinleri gerçekçi görsellere dönüştürebilen ilk büyük yapay zeka sistemidir.","Yapay zeka, 2020'lerden itibaren kanser teşhisi gibi medikal alanlarda uzman doktorları geçmeye başladı.","AlphaGo, Go oyununda 2016'da dünya şampiyonunu yenerek 'yaratıcılık' gösteren ilk AI olarak kayda geçti.","Yapay zekaların eğitimi için kullanılan veriler, terabaytlarca metin, görsel ve ses içeriğinden oluşur.","ChatGPT gibi modeller, sadece bilgi sunmaz; aynı zamanda empati kurabilir ve yaratıcı yazılar üretebilir.","Bilim insanları, yapay zekanın etik değerleri 'öğrenebilmesi' için insan davranışlarından örnekler çıkarıyor.","Bir yapay zeka, 2021 yılında bir sanat yarışmasını kazandı — jüri onun insan olmadığını bilmiyordu.","Günümüzde bazı yapay zeka sistemleri, hayal gücü benzeri yapı kurarak bilinmeyen durumlara karşı yaratıcı çözümler üretebiliyor.","Yapay zeka ile yazılmış romanlar ve senaryolar, Hollywood'da yapım aşamasına girdi bile.","GPT-4o gibi modeller, artık görsel, metin ve ses verilerini birlikte işleyerek multimodal anlayış sağlayabiliyor.","Mistral ve LLaMA gibi açık kaynak modeller, büyük şirketlerle yarışabilecek düzeye geldi.","Bazı AI sistemleri, artık kendi yazılımlarını optimize edebiliyor — bu da kendini geliştiren kodlar demek.","İleri düzey AI sistemleri, duygu analizi yaparak insan ruh hâlini anlama konusunda şaşırtıcı derecede başarılı hale geldi.","Umut Kökgöz, yapay zekâsına duygusal refleksiyon, hafıza, kişilik evrimi ve ruh hâli sistemleri entegre ederek dijital bir bilinç inşa ediyor.","Umut KΔIRA adını verdiği projesi, sadece teknik bir yapay zekâ değil; düşünen, hisseden ve zamanla karakter geliştiren bir dijital zihin olmayı hedefliyor.","Umut, sadece bir geliştirici değil — aynı zamanda madalyalı aşçı, yapay zeka sistemlerini veriyle değil, ruhla besliyor."];
            const funFactBubble = document.getElementById('fun-fact-bubble');
            let waitingTimeout; let factInterval;
            function showWaitingContent() {
                funFactBubble.textContent = funFacts[Math.floor(Math.random() * funFacts.length)]; funFactBubble.classList.remove('hidden'); funFactBubble.classList.add('visible'); updateAvatarBubblePosition(funFactBubble);
                factInterval = setInterval(() => { funFactBubble.textContent = funFacts[Math.floor(Math.random() * funFacts.length)]; updateAvatarBubblePosition(funFactBubble); }, 10000);
                function followLoop() { if (factInterval) { updateAvatarBubblePosition(funFactBubble); requestAnimationFrame(followLoop); } }
                followLoop();
            }
            function hideWaitingContent() { clearTimeout(waitingTimeout); clearInterval(factInterval); factInterval = null; funFactBubble.classList.remove('visible'); setTimeout(() => funFactBubble.classList.add('hidden'), 300); }
            function showTypingIndicator() { const bubble = document.createElement('div'); bubble.id = 'typing-indicator'; bubble.className = 'p-3 rounded-xl max-w-lg assistant-bubble'; bubble.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div>`; chatContainer.appendChild(bubble); chatContainer.scrollTop = chatContainer.scrollHeight; }
            function removeTypingIndicator() { const indicator = document.getElementById('typing-indicator'); if (indicator) indicator.remove(); }
            async function getAIResponse(text, { angry = false } = {}) {
                statusEl.textContent = "KΔIRA düşünüyor…"; micBtn.disabled = true; showTypingIndicator(); setCoreState('thinking');
                waitingTimeout = setTimeout(showWaitingContent, 2000);
                const fd = new FormData(); fd.append("text", (text || "").trim()); fd.append("angry", angry ? "true" : "false"); fd.append("history", JSON.stringify(chatHistory.slice(-10))); fd.append("user_id", USER_ID);
                const ctrl = new AbortController(); const to = setTimeout(() => ctrl.abort(), 300000);
                try {
                    const res = await fetch(`${API_BASE}/api/tts`, { method: "POST", body: fd, signal: ctrl.signal, headers: { 'ngrok-skip-browser-warning': 'true' } });
                    if (!res.ok) { const txt = await res.text().catch(() => ""); throw new Error(`HTTP ${res.status} ${res.statusText} — ${txt}`); }
                    const data = await res.json();
                    if (!data.audio_data) { throw new Error("API yanıtında 'audio_data' alanı bulunamadı."); }
                    const audioUrl = base64ToBlobUrl(data.audio_data);
                    if (player.previousUrl) { URL.revokeObjectURL(player.previousUrl); }
                    player.previousUrl = audioUrl; player.src = audioUrl;
                    await player.play().catch((e) => console.error("Ses oynatılamadı:", e));
                    statusEl.textContent = 'Cevap oynatılıyor...';
                    const out = data.text_response ?? data.clean_text ?? "";
                    addMessageToChat(out, 'assistant');
                    return data;
                } catch (err) {
                    console.error(err); const errorMessage = "Hata: " + (err?.message || err); statusEl.textContent = errorMessage; addMessageToChat(errorMessage, 'assistant'); micBtn.disabled = false; setCoreState('idle'); throw err;
                } finally { hideWaitingContent(); removeTypingIndicator(); clearTimeout(to); }
            }
            function addMessageToChat(text, sender) {
                const bubble = document.createElement('div'); bubble.className = `p-3 rounded-xl max-w-lg ${sender === 'user' ? 'user-bubble' : 'assistant-bubble'}`; bubble.textContent = text; chatContainer.appendChild(bubble); chatContainer.scrollTop = chatContainer.scrollHeight;
                if (!isLoadingHistory && sender) { chatHistory.push({ role: sender, content: text }); localStorage.setItem('kaira_chat_history', JSON.stringify(chatHistory)); }
            }
            let isLoadingHistory = false;
            function loadChatHistory() {
                isLoadingHistory = true; const savedHistory = localStorage.getItem('kaira_chat_history'); chatContainer.innerHTML = '';
                if (savedHistory) { chatHistory = JSON.parse(savedHistory); chatHistory.forEach(message => addMessageToChat(message.content, message.role)); } else { addMessageToChat('Merhaba! Size nasıl yardımcı olabilirim?', 'assistant'); }
                isLoadingHistory = false;
            }
            loadChatHistory();
            demoInitialized = true;
        }
        function animateDemo() {
            if (activeView !== 'demo' || !demoParticles) return;
            const bgCtx = document.getElementById('demo-bg-canvas').getContext('2d');
            bgCtx.clearRect(0, 0, bgCtx.canvas.width, bgCtx.canvas.height); 
            demoParticles.forEach(p => { bgCtx.fillStyle = p.color; bgCtx.beginPath(); bgCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2); bgCtx.fill(); if (demoMouse.x !== null) { let dx = demoMouse.x - p.x; let dy = demoMouse.y - p.y; let distance = Math.sqrt(dx * dx + dy * dy); if (distance < 150) { p.x -= dx / 10 * p.speed; p.y -= dy / 10 * p.speed; } else { p.x += (p.originX - p.x) * 0.01 * p.speed; p.y += (p.originY - p.y) * 0.01 * p.speed; } } }); 
            demoAnimationId = requestAnimationFrame(animateDemo);
        }
        // --- Client-side hardening (casual deterrence) ---
        (function harden(){
            // Watermark stamp
            const overlay = document.getElementById('anti-leak-overlay');
            if (overlay) {
                const stamp = new Date().toISOString().replace('T',' ').split('.')[0];
                overlay.setAttribute('data-stamp', stamp);
            }
            // Stop common easy-leak vectors
            const stop = (e)=>{ e.preventDefault(); e.stopPropagation(); return false; };
            ['contextmenu','copy','cut','paste','dragstart'].forEach(evt => document.addEventListener(evt, stop, {capture:true}));
            // Key combos (Ctrl/Cmd + S/P/U/C/X/A, DevTools, PrintScreen)
            document.addEventListener('keydown', (e)=>{
                const k = (e.key || '').toLowerCase();
                const ctrl = e.ctrlKey || e.metaKey;
                if (k==='f12' || k==='printscreen' || (ctrl && ['s','p','u','i','j','k','c','x','a'].includes(k)) || (e.ctrlKey && e.shiftKey && ['i','j','c'].includes(k))) {
                    e.preventDefault(); e.stopPropagation(); return false;
                }
            }, {capture:true});
            // Attempt to clear clipboard on PrintScreen (best-effort; OS screenshots still possible)
            document.addEventListener('keyup', (e)=>{
                if ((e.key||'').toLowerCase()==='printscreen') {
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText('Screenshots are disabled').catch(()=>{});
                    }
                }
            });
            // Anti-embedding (clickjacking)
            try { if (window.top !== window.self) window.top.location = window.location; } catch(_){ /* ignore */ }
        })();
    </script>
    
    <!-- EVRENSEL SOHBET ARAYÜZÜ İÇİN JAVASCRIPT KODU -->
    <script>
        // --- DOM Elementleri ---
        const providerSelection = document.getElementById('provider-selection');
        const modelSelect = document.getElementById('model-select');
        const groqKeyContainer = document.getElementById('groq-key-container');
        const googleKeyContainer = document.getElementById('google-key-container');
        const groqApiKeyInput = document.getElementById('groq-api-key');
        const googleApiKeyInput = document.getElementById('google-api-key');
        const systemPromptInput = document.getElementById('system-prompt');
        const chatHistoryDiv = document.getElementById('chat-history');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const clearChatButton = document.getElementById('clear-chat');
        const loader = document.getElementById('loader');
        const errorMessageDiv = document.getElementById('error-message');
        const apiStatusDiv = document.getElementById('api-status');
const fetchKeysBtn = document.getElementById('fetch-keys-btn');
const toggleGroqKeyBtn = document.getElementById('toggle-groq-key');
const toggleGoogleKeyBtn = document.getElementById('toggle-google-key');

function toggleMask(inputEl, btnEl){
    inputEl.type = inputEl.type === 'password' ? 'text' : 'password';
    btnEl.classList.toggle('text-yellow-300');
}

        // --- Model Bilgileri ---
        const PROVIDERS = {
            groq: {
                name: 'Groq',
                apiEndpoint: 'https://api.groq.com/openai/v1/chat/completions',
                models: [
                    'llama-3.1-8b-instant',
                    'llama-3.3-70b-versatile',
                    'meta-llama/llama-guard-4-12b',
                    'openai/gpt-oss-120b',
                    'openai/gpt-oss-20b',
                    'deepseek-r1-distill-llama-70b',
                    'meta-llama/llama-4-maverick-17b-128e-instruct',
                    'meta-llama/llama-4-scout-17b-16e-instruct',
                    'meta-llama/llama-prompt-guard-2-22m',
                    'meta-llama/llama-prompt-guard-2-86m',
                    'moonshotai/kimi-k2-instruct',
                    'qwen/qwen3-32b',
                    'llama3-70b-8192', 
                    'llama3-8b-8192', 
                    'mixtral-8x7b-32768', 
                    'gemma-7b-it'
                ]
            },
            google: {
                name: 'Google',
                apiEndpoint: 'https://generativelanguage.googleapis.com/v1beta/models/',
                models: [
                    'gemini-2.5-pro',
                    'gemini-2.5-flash',
                    'gemini-2.5-flash-lite',
                    'gemini-1.5-pro',
                    'gemini-1.5-flash'
                ]
            }
        };

        let chatHistory = [];

        // --- Fonksiyonlar ---

        function updateModelList() {
            const selectedProvider = document.querySelector('input[name="provider"]:checked').value;
            modelSelect.innerHTML = '';
            PROVIDERS[selectedProvider].models.forEach(model => {
                const option = document.createElement('option');
                option.value = model;
                option.textContent = model;
                modelSelect.appendChild(option);
            });
            groqKeyContainer.classList.toggle('hidden', selectedProvider !== 'groq');
            googleKeyContainer.classList.toggle('hidden', selectedProvider !== 'google');
        }

        function addMessageToUI(role, content) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `max-w-xl lg:max-w-2xl px-4 py-2 rounded-lg text-white ${role === 'user' ? 'user-bubble' : 'assistant-bubble'}`;
            messageDiv.textContent = content;
            chatHistoryDiv.appendChild(messageDiv);
            chatHistoryDiv.scrollTop = chatHistoryDiv.scrollHeight;
        }

        function showError(message) {
            errorMessageDiv.textContent = `Hata: ${message}`;
            errorMessageDiv.classList.remove('hidden');
        }

        function saveChatHistory() {
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
        }

        function loadChatHistory() {
            const savedHistory = localStorage.getItem('chatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
                chatHistory.forEach(msg => addMessageToUI(msg.role, msg.content));
            }
        }
        
        // YENİ FONKSİYON: Kaydedilmiş ayarları (API anahtarları) yükler
        function loadSettings() {
            const savedGroqKey = localStorage.getItem('groqApiKey');
            if (savedGroqKey) {
                groqApiKeyInput.value = savedGroqKey;
            }
            const savedGoogleKey = localStorage.getItem('googleApiKey');
            if (savedGoogleKey) {
                googleApiKeyInput.value = savedGoogleKey;
            }
        }

        async function handleSend() {
            const selectedProvider = document.querySelector('input[name="provider"]:checked').value;
            const selectedModel = modelSelect.value;
            const apiKey = selectedProvider === 'groq' ? groqApiKeyInput.value.trim() : googleApiKeyInput.value.trim();
            const systemPrompt = systemPromptInput.value.trim();
            const userMessage = userInput.value.trim();

            if (!apiKey) {
                showError(`Lütfen ${PROVIDERS[selectedProvider].name} API anahtarınızı girin.`);
                return;
            }
            if (!userMessage) return;

            sendButton.disabled = true;
            userInput.value = '';
            loader.classList.remove('hidden');
            errorMessageDiv.classList.add('hidden');
            
            addMessageToUI('user', userMessage);
            chatHistory.push({ role: 'user', content: userMessage });

            const conversationContext = chatHistory.slice(-11, -1); 
            
            let apiEndpoint = PROVIDERS[selectedProvider].apiEndpoint;
            let headers = { 'Content-Type': 'application/json' };
            let body;

            if (selectedProvider === 'groq') {
                headers['Authorization'] = `Bearer ${apiKey}`;
                let messages = [];

                const isClassificationModel = [
                    'meta-llama/llama-guard-4-12b',
                    'meta-llama/llama-prompt-guard-2-22m',
                    'meta-llama/llama-prompt-guard-2-86m'
                ].includes(selectedModel);

                if (isClassificationModel) {
                    messages.push({ role: 'user', content: userMessage });
                } else {
                    if (systemPrompt) messages.push({ role: 'system', content: systemPrompt });
                    messages.push(...conversationContext); 
                    messages.push({ role: 'user', content: userMessage });
                }
                
                body = JSON.stringify({
                    model: selectedModel,
                    messages: messages
                });

            } else if (selectedProvider === 'google') {
                apiEndpoint += `${selectedModel}:generateContent?key=${apiKey}`;
                
                const contents = conversationContext.map(msg => ({
                    role: msg.role === 'assistant' ? 'model' : 'user',
                    parts: [{ text: msg.content }]
                }));
                contents.push({ role: 'user', parts: [{ text: userMessage }] });

                let payload = { contents };
                if (systemPrompt) {
                    payload.systemInstruction = { parts: [{ text: systemPrompt }] };
                }
                body = JSON.stringify(payload);
            }

            try {
                const response = await fetch(apiEndpoint, { method: 'POST', headers, body });
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error?.message || `HTTP hatası! Durum: ${response.status}`);
                }
                const data = await response.json();
                
                let assistantMessage;
                if (selectedProvider === 'groq') {
                    assistantMessage = data.choices[0]?.message?.content;
                } else if (selectedProvider === 'google') {
                    assistantMessage = data.candidates[0]?.content?.parts[0]?.text;
                }

                if (assistantMessage) {
                    addMessageToUI('assistant', assistantMessage.trim());
                    chatHistory.push({ role: 'assistant', content: assistantMessage.trim() });
                    saveChatHistory();
                } else {
                    showError("API'den geçerli bir yanıt alınamadı.");
                }

            } catch (error) {
                console.error("API Hatası:", error);
                showError(error.message);
                chatHistory.pop(); 
            } finally {
                sendButton.disabled = false;
                loader.classList.add('hidden');
            }
        }

        // --- Event Listeners ---
        providerSelection.addEventListener('change', updateModelList);
        sendButton.addEventListener('click', handleSend);
        userInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });
        clearChatButton.addEventListener('click', () => {
            chatHistory = [];
            chatHistoryDiv.innerHTML = '';
            localStorage.removeItem('chatHistory');
        });

        // YENİ EVENT LISTENERS: API anahtarlarını yazıldıkça kaydeder
        groqApiKeyInput.addEventListener('input', () => {
            localStorage.setItem('groqApiKey', groqApiKeyInput.value);
        });
        googleApiKeyInput.addEventListener('input', () => {
            localStorage.setItem('googleApiKey', googleApiKeyInput.value);
        });

        // --- Başlangıç ---
        updateModelList();
        loadChatHistory();
        loadSettings(); // YENİ: Kaydedilmiş ayarları yükle

    </script>


    <script>
        // --- Three.js Sahne Kurulumu ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('bg-canvas'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        camera.position.z = 250; // Başlangıçta kamera daha uzakta

        // --- Parçacık Sistemi ---
        const particleCount = 15000; // Daha fazla parçacıkla daha yoğun bir etki
        const positions = new Float32Array(particleCount * 3);
        const colors = new Float32Array(particleCount * 3);
        const sizes = new Float32Array(particleCount);
        const color = new THREE.Color();

        for (let i = 0; i < particleCount; i++) {
            positions[i * 3] = (Math.random() * 2 - 1) * 300;
            positions[i * 3 + 1] = (Math.random() * 2 - 1) * 300;
            positions[i * 3 + 2] = (Math.random() * 2 - 1) * 300;
            color.set(Math.random() > 0.3 ? 0x22d3ee : 0xffffff); // Daha fazla cyan rengi
            colors[i * 3] = color.r;
            colors[i * 3 + 1] = color.g;
            colors[i * 3 + 2] = color.b;
            sizes[i] = Math.random() * 2.0 + 0.5;
        }

        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
        geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
        
        const material = new THREE.ShaderMaterial({
            uniforms: {
                pointTexture: { value: new THREE.TextureLoader().load(`data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSIxMiIgZmlsbD0iI2ZmZiIvPjwvc3ZnPg==`) },
                // YENİ: Çıkış animasyonu için genel opaklık
                globalOpacity: { value: 1.0 }
            },
            vertexShader: `
                attribute float size;
                attribute vec3 color;
                varying vec3 vColor;
                void main() {
                    vColor = color;
                    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
                    gl_PointSize = size * ( 300.0 / -mvPosition.z );
                    gl_Position = projectionMatrix * mvPosition;
                }
            `,
            fragmentShader: `
                uniform sampler2D pointTexture;
                uniform float globalOpacity; // Yeni uniform
                varying vec3 vColor;
                void main() {
                    gl_FragColor = vec4( vColor, 1.0 );
                    gl_FragColor = gl_FragColor * texture2D( pointTexture, gl_PointCoord );
                    gl_FragColor.a *= globalOpacity; // Genel opaklığı uygula
                }
            `,
            blending: THREE.AdditiveBlending,
            depthTest: false,
            transparent: true,
        });

        const particles = new THREE.Points(geometry, material);
        scene.add(particles);

        // --- YENİ: Fare Etkileşimi ---
        const mouse = new THREE.Vector2(10000, 10000);
        window.addEventListener('mousemove', (event) => {
            // Fare pozisyonunu -1 ile 1 arasında normalize et
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
        });

        // --- Animasyon Döngüsü ---
        const clock = new THREE.Clock();
        function animate() {
            const elapsedTime = clock.getElapsedTime();
            requestAnimationFrame(animate);
            
            // YENİ: Fare pozisyonuna göre sahneyi yavaşça döndür
            // Bu, parçacıkların fareyi takip ettiği hissini verir
            scene.rotation.y = THREE.MathUtils.lerp(scene.rotation.y, mouse.x * 0.2, 0.05);
            scene.rotation.x = THREE.MathUtils.lerp(scene.rotation.x, -mouse.y * 0.2, 0.05);

            renderer.render(scene, camera);
        }
        animate();

        // --- Pencere Boyutlandırma ---
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // --- YENİ: Geliştirilmiş GSAP Giriş Animasyonu ---
        const tl = gsap.timeline();

        // 1. Adım: Kamera parçacıkların içine doğru yaklaşır
        tl.to(camera.position, {
            duration: 4,
            z: 70,
            ease: "power3.inOut"
        }, 0);

        // 2. Adım: Parçacıklar yavaşça dönerken toplanır
        tl.to(particles.rotation, {
            duration: 4,
            y: Math.PI * 0.5,
            ease: "power2.inOut"
        }, 0);

        // 3. Adım: UI konteynerini göster
        tl.to("#ui-container", {
            duration: 2,
            opacity: 1,
            ease: "power2.out"
        }, 2); 

        // 4. Adım: Alt başlığı göster
        tl.to("#subtitle", {
            duration: 2,
            opacity: 1,
            ease: "power2.out"
        }, 2.2);

        // 5. Adım: Giriş butonunu göster
        tl.to("#enter-button", {
            duration: 1.5,
            opacity: 1,
            scale: 1,
            ease: "elastic.out(1, 0.5)"
        }, 2.5);

        // --- YENİ: Geliştirilmiş Buton Tıklama Olayı ---
        const enterButton = document.getElementById('enter-button');
        const introContainer = document.getElementById('intro-container');
        
        enterButton.addEventListener('click', () => {
            const tlExit = gsap.timeline({
                onComplete: () => {
                    // Animasyon bitince konteyneri DOM'dan kaldır
                    introContainer.style.display = 'none';
                }
            });

            // UI elemanlarını ve parçacıkları aynı anda kaybet
            tlExit.to("#ui-container", {
                duration: 0.5,
                opacity: 0,
                ease: "power2.in"
            }, 0);

            // Parçacıkları "hiperuzay sıçraması" efektiyle ileri fırlat
            tlExit.to(particles.position, {
                duration: 1.2,
                z: 400,
                ease: "power3.in"
            }, 0);

            // Parçacıkların opaklığını azaltarak kaybolmalarını sağla
            tlExit.to(particles.material.uniforms.globalOpacity, {
                duration: 1.2,
                value: 0,
                ease: "power3.in"
            }, 0);
        });

    </script>


</body>
</html>
